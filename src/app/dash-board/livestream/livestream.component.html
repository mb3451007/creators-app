<div class="livestream-container p-4">
  <h1 class="text-center mb-4">Live Streaming</h1>

  <!-- Video Containers -->
  <div class="video-container-wrapper mb-3 mb-sm-5 position-relative">
    <div id="local-video" class="video-container rounded-3 shadow"></div>
    <div
      class="stream-actions text-center position-absolute bottom-0 start-50 translate-middle-x mb-2"
    >
      <button
        *ngIf="!streamStarted"
        class="rounded-circle p-3 bg-light"
        (click)="startStream()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
          width="25"
          height="25"
          fill="green"
        >
          <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
          <path
            d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80L0 432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"
          />
        </svg>
      </button>

      <button
        *ngIf="streamStarted || streamJoined"
        class="rounded-circle p-2 bg-light"
        (click)="toggleAudio()"
      >
        <ng-container *ngIf="isAudioMuted; else unmutedIcon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 640 512"
            width="20"
            height="20"
            fill="#6c757d"
          >
            <!-- Muted Icon -->
            <path
              d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L472.1 344.7c15.2-26 23.9-56.3 23.9-88.7l0-40c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 21.2-5.1 41.1-14.2 58.7L416 300.8 416 96c0-53-43-96-96-96s-96 43-96 96l0 54.3L38.8 5.1zM344 430.4c20.4-2.8 39.7-9.1 57.3-18.2l-43.1-33.9C346.1 382 333.3 384 320 384c-70.7 0-128-57.3-128-128l0-8.7L144.7 210c-.5 1.9-.7 3.9-.7 6l0 40c0 89.1 66.2 162.7 152 174.4l0 33.6-48 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l72 0 72 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-48 0 0-33.6z"
            />
          </svg>
        </ng-container>
        <ng-template #unmutedIcon>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 384 512"
            width="20"
            height="20"
            fill="#6c757d"
          >
            <!-- Unmuted Icon -->
            <path
              d="M192 0C139 0 96 43 96 96l0 160c0 53 43 96 96 96s96-43 96-96l0-160c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 89.1 66.2 162.7 152 174.4l0 33.6-48 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l72 0 72 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-48 0 0-33.6c85.8-11.7 152-85.3 152-174.4l0-40c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 40c0 70.7-57.3 128-128 128s-128-57.3-128-128l0-40z"
            />
          </svg>
        </ng-template>
      </button>
      <button
        *ngIf="streamStarted || streamJoined"
        class="rounded-circle p-3 bg-light"
        (click)="ngOnDestroy()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
          width="25"
          height="25"
          fill="#dc3545"
        >
          <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
          <path
            d="M177.5 414c-8.8 3.8-19 2-26-4.6l-144-136C2.7 268.9 0 262.6 0 256s2.7-12.9 7.5-17.4l144-136c7-6.6 17.2-8.4 26-4.6s14.5 12.5 14.5 22l0 72 288 0c17.7 0 32 14.3 32 32l0 64c0 17.7-14.3 32-32 32l-288 0 0 72c0 9.6-5.7 18.2-14.5 22z"
          />
        </svg>
      </button>
      <button
        *ngIf="streamStarted || streamJoined"
        class="rounded-circle p-2 bg-light"
        (click)="toggleVideo()"
      >
        <ng-container *ngIf="isVideoOff; else videoOnIcon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 576 512"
            width="20"
            height="20"
            fill="#6c757d"
          >
            <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
            <path
              d="M0 128C0 92.7 28.7 64 64 64l256 0c35.3 0 64 28.7 64 64l0 256c0 35.3-28.7 64-64 64L64 448c-35.3 0-64-28.7-64-64L0 128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2l0 256c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1l0-17.1 0-128 0-17.1 14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z"
            />
          </svg>
        </ng-container>
        <ng-template #videoOnIcon>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 640 512"
            width="20"
            height="20"
            fill="#6c757d"
          >
            <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
            <path
              d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7l-86.4-67.7 13.8 9.2c9.8 6.5 22.4 7.2 32.9 1.6s16.9-16.4 16.9-28.2l0-256c0-11.8-6.5-22.6-16.9-28.2s-23-5-32.9 1.6l-96 64L448 174.9l0 17.1 0 128 0 5.8-32-25.1L416 128c0-35.3-28.7-64-64-64L113.9 64 38.8 5.1zM407 416.7L32.3 121.5c-.2 2.1-.3 4.3-.3 6.5l0 256c0 35.3 28.7 64 64 64l256 0c23.4 0 43.9-12.6 55-31.3z"
            />
          </svg>
        </ng-template>
      </button>
    </div>
  </div>

  <!-- Action Buttons for Creator and Subscriber -->

  <!-- Active Streams Section for Subscribers -->
  <div class="stream-list col-lg-8 col-md-10 mx-auto mb-4">
    <div
      *ngIf="activeStreams.length > 0 && !streamJoined"
      class="available-streams text-center p-3 rounded bg-light shadow"
    >
      Live Streams Available
    </div>
    <div
      *ngIf="activeStreams.length === 0"
      class="no-streams text-center p-3 rounded bg-light shadow"
    >
      No Streams Available
    </div>

    <div *ngIf="activeStreams.length > 0 && !streamJoined">
      <div
        *ngFor="let stream of activeStreams"
        class="stream-item p-3 mb-3 d-flex align-items-center justify-content-between rounded shadow"
      >
        <div class="creator-info d-flex align-items-center">
          <div class="profile-img me-3">
            <img
              [src]="getMediaUrl(stream.creator.profile)"
              alt="Profile Image"
              class="rounded-circle"
              width="50"
              height="50"
            />
          </div>
          <div class="creator-details">
            <div class="creator-name fw-bold">{{ stream.creator.name }}</div>
            <div class="creator-username text-muted">
              @{{ stream.creator.username }}
            </div>
          </div>
        </div>
        <div>
          <button
            (click)="joinStream(stream)"
            class="join-btn px-4 py-2 bg-primary text-light rounded"
          >
            Join Now
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
